{% extends "base.html" %}

{% block title %}  Click on one of the following plugins to see their status: &ndash; {{ super() }}{% endblock %}


{% block head %}
{{ super() }}
<style>
    .status {
        padding-left: 250px;
    }

    .status-title{
        padding-left: 230px;
    }

    .status-item {
        color: rgba(0,0,0,.5);
        font-size: medium;
    }
    a:hover {
        color: black;
        text-decoration: none;
    }
    .customTable {
        position: absolute;
        left: 230px;
        font-size: medium;
    }
    .customCell {
        height: 50px;
    }
    .dataCell > td{
        text-align: center;
    }
    .greyedCell > td{
        background-color: rgb(206, 206, 206);
    }
</style>
{% endblock %}


{% block content %}
<br>
<br>
<h2 class="status-title">
    Click on one of the following plugins to see their detailed status:
</h2>
<br>

<div class="table-responsive customTable">
    <table
      class="table table-striped table-sm"
      id="data-table"
      data-toggle="table"
      data-show-button-icons="false"
      data-show-button-text="true">
      <thead class="thead-dark">
        <tr>
          <th scope="col" data-field="url">Plugin</th>
          <th scope="col" data-field="url">Health</th>
          <th scope="col" data-field="url">Status</th>
          <th scope="col" data-field="url">Success / Total</th>
          <th scope="col" > Last Run (Start time) </th>
          <th scope="col" > Duration </th>
      </thead>
      <tbody>
        {% for metric in metrics %}
        <tr class="customCell dataCell ">
            <th scope="row">
                <a href="/status/{{metric.database}}" class="status-item">{{ metric.name }}</a>
            </th>
            <td class=" {{ healthColor(summaryStatus[metric.name].alive) }}">
                {{ summaryStatus[metric.name].alive }}
            </td>
            <td class=" {{ thresholdColor([2, summaryStatus[metric.database].allUrls], summaryStatus[metric.database].success) if summaryStatus[metric.name].status == 'FINISHED' }}">
                {{ summaryStatus[metric.name].status }}
            </td>
            <td class="dataCell {{ thresholdColor([2, summaryStatus[metric.database].allUrls], summaryStatus[metric.database].success) if summaryStatus[metric.name].status == 'FINISHED' }}">
                {% set successful_urls =  summaryStatus[metric.database].success %}
                {% if successful_urls != 0 %}
                    {{ successful_urls  }} / {{ summaryStatus[metric.database].allUrls }}
                {% else %}
                    - / {{ summaryStatus[metric.database].allUrls }}
                {% endif %}
            </td>
            <td class="dataCell {{ thresholdColor([2, summaryStatus[metric.database].allUrls], summaryStatus[metric.database].success) if summaryStatus[metric.name].status == 'FINISHED' }}">
                {{ summaryStatus[metric.database].lastRun }}
            </td>
            <td class="dataCell {{ thresholdColor([2, summaryStatus[metric.database].allUrls], summaryStatus[metric.database].success) if summaryStatus[metric.name].status == 'FINISHED' }}">
                {% if summaryStatus[metric.name].duration %}
                    {% set time = summaryStatus[metric.name].duration %}
                    {{ (time/ 3600) |int }}h {{ ((time % 3600) / 60) |round|int }}m {{ (time % 60) |round|int }}s
                {% else %}
                    -
                {% endif %}
            </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    </div>

{% endblock %}


{% block finalscripts %}
{{ super() }}

{% endblock %}